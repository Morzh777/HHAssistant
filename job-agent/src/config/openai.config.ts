/* eslint-disable @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-return */
export interface OpenAIConfig {
  model: string;
  temperature: number;
  maxTokens?: number;
  maxCompletionTokens?: number;
}

export const OPENAI_CONFIGS = {
  // Конфигурация для генерации сопроводительных писем
  COVER_LETTER: {
    model: 'gpt-5-mini',
    // GPT-5 mini не поддерживает кастомную температуру, только default (1)
  } as OpenAIConfig,

  // Конфигурация для анализа HTML резюме
  RESUME_ANALYSIS_HTML: {
    model: 'gpt-5-mini',
    // GPT-5 mini не поддерживает кастомную температуру, только default (1)
  } as OpenAIConfig,

  // Конфигурация для анализа текста резюме
  RESUME_ANALYSIS_TEXT: {
    model: 'gpt-5-mini',
    // GPT-5 mini не поддерживает кастомную температуру, только default (1)
  } as OpenAIConfig,

  // Конфигурация для проверки API
  API_CHECK: {
    model: 'gpt-5-mini',
    // GPT-5 mini не поддерживает кастомную температуру, только default (1)
  } as OpenAIConfig,

  // Конфигурация для анализа вакансий на токсичность
  VACANCY_ANALYSIS: {
    model: 'gpt-5-mini',
    // GPT-5 mini не поддерживает кастомную температуру, только default (1)
  } as OpenAIConfig,

  // Конфигурация для эмбеддингов (pgvector)
  EMBEDDINGS: {
    model: 'text-embedding-3-small',
    temperature: 0,
  } as OpenAIConfig,
} as const;

// Системные промпты
export const SYSTEM_PROMPTS = {
  COVER_LETTER:
    'Ты пишешь короткие сопроводительные письма для российского рынка труда. Пиши как живой человек - естественно, но профессионально. Избегай шаблонов, формальностей и американских клише. НЕ упоминай зарплату, компенсацию или деньги - это неуместно. Фокусируйся на конкретных технологиях и опыте. Пиши в российском стиле.',

  RESUME_ANALYSIS:
    'Ты эксперт по анализу резюме. Извлекай только факты из HTML, не добавляй ничего от себя. Отвечай только в формате JSON.',

  RESUME_TEXT_ANALYSIS:
    'Ты эксперт по анализу резюме. Извлекай только факты из текста, не добавляй ничего от себя. Отвечай только в формате JSON.',

  VACANCY_ANALYSIS:
    'Ты эксперт по HR и рынку труда. Анализируешь вакансии на токсичность, красные флаги и адекватность работодателя. Помогаешь соискателям избегать плохих компаний. Отвечай только в формате JSON.',
} as const;

// Промпты для пользователя
export const USER_PROMPTS = {
  COVER_LETTER: (resumeData: any, vacancyData: any, vacancyAnalysis?: any) => `
Напиши короткое сопроводительное письмо на основе резюме и вакансии.

РЕЗЮМЕ:
${JSON.stringify(resumeData, null, 2)}

ВАКАНСИЯ:
${JSON.stringify(vacancyData, null, 2)}

${
  vacancyAnalysis
    ? `АНАЛИЗ ВАКАНСИИ (учти эту информацию при составлении письма):
- Рекомендация: ${vacancyAnalysis.recommendation}
- Уровень токсичности: ${vacancyAnalysis.toxicityScore}/10
- Красные флаги: ${Array.isArray(vacancyAnalysis.redFlags) ? vacancyAnalysis.redFlags.join(', ') : 'не обнаружены'}
- Плюсы: ${Array.isArray(vacancyAnalysis.positives) ? vacancyAnalysis.positives.join(', ') : 'не указаны'}
- Резюме анализа: ${vacancyAnalysis.summary}
- Адекватность зарплаты: ${vacancyAnalysis.salaryAdequacy}
- Соответствие опыту: ${vacancyAnalysis.experienceMatch}

ВАЖНО: 
- Если есть красные флаги - будь осторожнее в формулировках
- Если recommendation = "avoid" - можешь быть менее восторженным
- Если recommendation = "apply" - можешь проявить больше энтузиазма
- Используй информацию об адекватности условий для тона письма
`
    : ''
}

Правила:
- Начинай с "Здравствуйте! Заинтересовала ваша вакансия"
- Максимум 2 абзаца
- Пиши как живой человек - естественно и без формальностей
- Упомяни конкретные технологии и проекты из резюме
- Покажи, что читал вакансию - упомяни название позиции, но НЕ название компании
- Свяжи свой опыт с требованиями вакансии
- Используй живые фразы: "хочется", "интересно", "готов"
- Избегай: "выразить интерес", "отличная возможность", "профессиональный рост", "компенсация", "заработная плата"
- НЕ упоминай названия компаний/проектов - пиши про технологии и задачи
- НЕ пиши про зарплату, деньги, компенсацию - это неуместно в сопроводительном письме
- Пиши от первого лица
- Закончи естественно, без "С уважением"
- НЕ придумывай лишние детали
- Пиши в российском стиле - без американских клише

Пример стиля:
"Здравствуйте! Заинтересовала ваша вакансия Node.js-разработчика — у меня есть реальные проекты на Node.js и TypeScript. Строил микросервисный бэкенд на NestJS с PostgreSQL, делал gRPC-интеграции и AI-классификацию, писал Telegram-бота с оплатами и API Gateway. Хочется применять эти технологии в новых проектах."

Дополнительные примеры российского стиля:
- "Интересно поработать с вашей командой над проектами на React"
- "Готов обсудить детали и рассказать о своем опыте"
- "Хочется развиваться в направлении фронтенд-разработки"
- "Готов приступить к работе и показать результат"

Ответ: только текст письма.
`,

  RESUME_ANALYSIS_HTML: (html: string) => `
Проанализируй HTML код резюме с сайта hh.ru и извлеки структурированную информацию в JSON формате.

ВАЖНО: Обязательно найди и включи ВСЕ секции резюме: Опыт работы, Навыки, Образование, О себе, Повышение квалификации/курсы, Тесты и экзамены, Сертификаты.

Верни JSON объект со следующей структурой:
{
  "personalInfo": {
    "fullName": "ФИО",
    "email": "email",
    "phone": "телефон",
    "location": "местоположение"
  },
  "position": "желаемая должность",
  "about": "краткое описание о себе",
  "experience": [
    {
      "company": "название компании",
      "position": "должность",
      "period": "период работы",
      "description": "описание обязанностей"
    }
  ],
  "education": [
    {
      "institution": "учебное заведение",
      "degree": "степень/специальность",
      "period": "период обучения"
    }
  ],
  "skills": [
    {
      "name": "название навыка",
      "level": "уровень (если указан)",
      "verified": "подтвержден ли навык"
    }
  ],
  "languages": [
    {
      "language": "язык",
      "level": "уровень владения"
    }
  ],
  "courses": [
    {
      "name": "название курса",
      "institution": "учреждение",
      "period": "период прохождения",
      "description": "описание курса"
    }
  ],
  "tests": [
    {
      "name": "название теста/экзамена",
      "score": "результат",
      "period": "период прохождения",
      "description": "описание"
    }
  ],
  "certificates": [
    {
      "name": "название сертификата",
      "issuer": "выдающая организация",
      "period": "период получения",
      "description": "описание"
    }
  ],
  "additionalInfo": {
    "projects": [],
    "other": "другая информация"
  }
}

HTML код резюме:
${html}
`,

  RESUME_ANALYSIS_TEXT: (text: string) => `
Проанализируй текст резюме с сайта hh.ru и извлеки структурированную информацию в JSON формате.

ВАЖНО: Внимательно найди и включи ВСЕ секции резюме:
- Опыт работы (места работы, должности, периоды, описания)
- Навыки (технологии, языки программирования, инструменты)
- Образование (учебные заведения, специальности, годы)
- О себе (краткое описание кандидата, его цели, особенности)
- Повышение квалификации/курсы (дополнительное обучение, курсы)
- Тесты и экзамены (пройденные тесты, результаты)
- Сертификаты (полученные сертификаты, дипломы)

Если какая-то секция отсутствует в резюме, оставь соответствующий массив пустым [].

Верни JSON объект со следующей структурой:
{
  "personalInfo": {
    "fullName": "ФИО",
    "email": "email",
    "phone": "телефон",
    "location": "местоположение"
  },
  "position": "желаемая должность",
  "about": "краткое описание о себе (если есть)",
  "experience": [
    {
      "company": "название компании",
      "position": "должность",
      "period": "период работы",
      "description": "описание обязанностей"
    }
  ],
  "education": [
    {
      "institution": "учебное заведение",
      "degree": "степень/специальность",
      "period": "период обучения"
    }
  ],
  "skills": [
    {
      "name": "название навыка",
      "level": "уровень (если указан)",
      "verified": "подтвержден ли навык"
    }
  ],
  "languages": [
    {
      "language": "язык",
      "level": "уровень владения"
    }
  ],
  "courses": [
    {
      "name": "название курса",
      "institution": "учреждение",
      "period": "период прохождения",
      "description": "описание курса"
    }
  ],
  "tests": [
    {
      "name": "название теста/экзамена",
      "score": "результат",
      "period": "период прохождения",
      "description": "описание"
    }
  ],
  "certificates": [
    {
      "name": "название сертификата",
      "issuer": "выдающая организация",
      "period": "период получения",
      "description": "описание"
    }
  ],
  "additionalInfo": {
    "projects": [],
    "other": "другая информация"
  }
}

Текст резюме:
${text}
`,

  VACANCY_ANALYSIS: (vacancyData: any, resumeData?: any) => `
Проанализируй вакансию на токсичность, красные флаги и адекватность работодателя.

ДАННЫЕ ВАКАНСИИ:
${JSON.stringify(vacancyData, null, 2)}

${resumeData ? `ДАННЫЕ РЕЗЮМЕ КАНДИДАТА (используй, чтобы оценить соответствие и дать персональную рекомендацию):\n${JSON.stringify(resumeData, null, 2)}\n` : ''}

Проверь следующие аспекты:

🚩 КРАСНЫЕ ФЛАГИ:
- Неадекватные требования к опыту vs зарплата
- Размытые обязанности ("от всего понемногу")
- Токсичные фразы в описании
- Завышенные требования для джуниора
- Подозрительно низкая/высокая зарплата
- Отсутствие четких условий работы
- Требования работать сверхурочно "за идею"
- Упоминание "дружной семьи" как замена нормальных условий

✅ ПЛЮСЫ:
- Четкие требования и обязанности
- Адекватная зарплата для уровня
- Хорошие условия работы
- Возможности роста и обучения
- Современные технологии
- Удаленная работа или гибкий график
- Социальный пакет

📊 ОЦЕНКА (учитывай резюме, если предоставлено):
- Общий рейтинг токсичности (1-10, где 10 - очень токсично)
- Рекомендация откликаться или нет ("apply" | "avoid" | "caution")
- Краткое объяснение решения

Верни результат в JSON формате:
{
  "toxicityScore": число от 1 до 10,
  "recommendation": "apply" | "avoid" | "caution",
  "redFlags": ["список красных флагов"],
  "positives": ["список плюсов"],
  "summary": "краткое резюме на русском",
  "salaryAdequacy": "adequate" | "low" | "high" | "not_specified",
  "experienceMatch": "junior_friendly" | "requires_experience" | "unrealistic"
}`,
} as const;

// Пути и директории
export const FILE_PATHS = {
  COVER_LETTERS_DIR: 'job-agent/data/cover-letters',
  VACANCIES_DIR: 'job-agent/data/vacancies',
  RESUMES_DIR: 'job-agent/data/resumes',
} as const;

// Шаблоны имен файлов
export const FILE_TEMPLATES = {
  COVER_LETTER: 'cover_letter_{vacancyId}_{date}.txt',
  VACANCY: 'vacancy_{vacancyId}_{date}.json',
  RESUME: '{resumeId}.html',
} as const;

// Регулярные выражения
export const REGEX_PATTERNS = {
  COVER_LETTER_VACANCY_ID: /cover_letter_([^_]+)_/,
  VACANCY_FILE: /vacancy_([^_]+)_/,
  FILE_SEPARATOR: /========================/,
  RESUME_ID: /\/resume\/([a-f0-9]+)/,
} as const;

// Шаблоны содержимого файлов
export const FILE_CONTENT_TEMPLATES = {
  COVER_LETTER_HEADER: `СОПРОВОДИТЕЛЬНОЕ ПИСЬМО
========================

Вакансия: {vacancyName}
ID вакансии: {vacancyId}
Дата генерации: {generatedAt}
Зарплата: {salary}

========================

{coverLetter}

========================
Сгенерировано с помощью OpenAI API`,
} as const;

// Константы
export const CONSTANTS = {
  UNKNOWN_VALUE: 'unknown',
  NOT_SPECIFIED: 'Не указано',
  NOT_SPECIFIED_SALARY: 'Не указана',
  DATE_FORMAT: 'YYYY-MM-DD',
} as const;
